<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ NHSO Vercel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Kanit', sans-serif; } </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">

    <!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin -->
    <div id="admin-modal" class="hidden fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-all duration-300">
        <div class="bg-white rounded-3xl p-8 w-full max-w-sm shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 to-orange-400"></div>
            <div class="text-center mb-6 mt-2">
                <div class="bg-red-50 text-red-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-800">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p class="text-slate-500 text-sm mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</p>
            </div>
            
            <input type="password" id="admin-pwd-input" onkeypress="if(event.key==='Enter') verifyAdmin()" class="w-full border-2 border-slate-200 rounded-xl p-4 mb-2 text-center text-lg tracking-widest focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <p id="admin-error" class="text-red-500 text-sm hidden mb-4 text-center font-medium"></p>
            
            <div class="flex gap-3 mt-6">
                <button onclick="closeAdminModal()" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium p-4 rounded-xl transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="verifyAdmin()" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium p-4 rounded-xl shadow-lg shadow-red-500/30 transition">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- ‡πÅ‡∏ú‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å (‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î) -->
    <div id="main-panel" class="bg-white rounded-2xl shadow-xl w-full max-w-md relative overflow-hidden flex flex-col h-[550px]">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-green-400"></div>
        
        <div class="p-8 flex-grow flex flex-col">
            <div class="flex justify-between items-start mb-6 mt-2">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</h1>
                    <p class="text-slate-500 text-sm font-medium mt-1">PG0190010 (‡∏ô‡∏ß‡∏î ‡∏≠‡∏ö ‡∏õ‡∏£‡∏∞‡∏Ñ‡∏ö)</p>
                </div>
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Modal ‡∏Ç‡∏≠‡∏á Admin -->
                <button onclick="promptAdmin()" class="p-2 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-600 transition" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Admin)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>

            <!-- Area ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡πà‡∏≤‡∏á‡πÜ -->
            <div id="loading" class="hidden flex-grow flex flex-col items-center justify-center">
                <svg class="animate-spin h-10 w-10 text-blue-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-slate-500 text-sm animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥...</p>
            </div>

            <div id="result-container" class="flex-grow flex flex-col items-center justify-center">
                <div class="bg-blue-50 rounded-2xl p-6 border border-blue-100 w-full text-center">
                    <p class="text-sm text-blue-600 font-semibold mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                    <div id="quota-value" class="text-7xl font-black text-blue-600 mb-2 drop-shadow-sm">--</div>
                    <p class="text-sm text-slate-500">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                </div>
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• JSON ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏´‡∏≤ Field ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ -->
                <div id="debug-info" class="hidden w-full mt-4 text-[10px] text-left bg-slate-100 p-3 rounded-lg overflow-auto max-h-24 text-slate-600 font-mono border border-slate-200">
                </div>
            </div>

            <div id="error-container" class="hidden flex-grow flex flex-col items-center justify-center">
                <div class="bg-red-50 rounded-2xl p-6 border border-red-100 text-red-600 w-full text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 opacity-75" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <p id="error-msg" class="text-sm font-medium">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>
                    <p id="error-sub-msg" class="text-xs text-red-400 mt-2 break-words">‡∏´‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô Error 401 ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Cookie ‡πÉ‡∏´‡∏°‡πà</p>
                </div>
            </div>

            <div class="mt-auto pt-6">
                <button onclick="fetchData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition duration-200 flex items-center justify-center gap-2 shadow-lg shadow-blue-500/30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                </button>
                <p class="text-center text-xs text-slate-400 mt-4">
                    ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="last-update" class="font-medium text-slate-500">-</span>
                </p>
            </div>
        </div>
    </div>

    <!-- ‡πÅ‡∏ú‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà) -->
    <div id="settings-panel" class="hidden bg-white rounded-2xl shadow-xl w-full max-w-md relative overflow-hidden h-[550px] flex flex-col">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
            <h2 class="text-lg font-bold text-slate-800">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
            <button onclick="closeSettings()" class="text-slate-400 hover:text-red-500 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        
        <div class="p-6 flex-grow overflow-y-auto">
            <div class="mb-4">
                <label class="block text-sm font-medium text-slate-700 mb-1">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (PID)</label>
                <input type="text" id="input-pid" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5101200017501">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-slate-700 mb-1">Cookie ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                <textarea id="input-cookie" rows="6" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-xs font-mono focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="‡∏ß‡∏≤‡∏á Cookie ‡∏ó‡∏µ‡πà‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ..."></textarea>
                <p class="text-xs text-slate-500 mt-2">* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô Error 401 ‡πÉ‡∏´‡πâ‡∏Å‡∏î F5 ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö ‡∏™‡∏õ‡∏™‡∏ä. ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ Cookie ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
            </div>
        </div>

        <div class="p-6 border-t border-slate-100 bg-slate-50">
            <button onclick="saveSettings()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-xl transition duration-200 shadow-lg shadow-green-500/30">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            </button>
        </div>
    </div>

    <script>
        // ==========================================
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Hardcode Defaults)
        // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 
        // ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏î‡πÜ
        // ==========================================
        const DEFAULT_PID = '5101200017501';
        const DEFAULT_COOKIE = '_ga_TRYKLSJ30C=GS2.1.s1765192592$o1$g0$t1765192592$j60$l0$h0; _ga=GA1.1.2080104490.1755560245; _ga_RSYZ8B7GPX=GS2.1.s1766390934$o10$g0$t1766390934$j60$l0$h0; _ga_517PBQ0JGD=GS2.1.s1770801540$o5$g1$t1770801835$j60$l0$h0; NSXLB.08e66a20-88b5-4993-b298-52bdcec3f081.2c4bdfdf-08be-4219-a853-800d0458e6fc=rzN4OY9S3k7hLulZnhXuYTye8fCLexppqaJhSZmF5knEU+ZjVGweS/Xy2ZAjB4XRD1lZwItzdnALhRicUR7SmA==; LIFF_STORE:expires:1654412393-QTAwCDJ1=1771983482972; app_session=22eb114e-99ea-47c9-8482-0c7ec83ee467';
        // ==========================================

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin
        const ADMIN_PWD = '@Pp1100506232';
        
        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Brute-force (‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏≤‡∏£‡∏´‡∏±‡∏™)
        let failedAttempts = 0;
        let lockoutTimer = null;

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ Admin ---
        function promptAdmin() {
            if (lockoutTimer) {
                alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà');
                return;
            }
            document.getElementById('admin-modal').classList.remove('hidden');
            document.getElementById('admin-pwd-input').value = '';
            document.getElementById('admin-error').classList.add('hidden');
            setTimeout(() => document.getElementById('admin-pwd-input').focus(), 100);
        }

        function closeAdminModal() {
            document.getElementById('admin-modal').classList.add('hidden');
        }

        function verifyAdmin() {
            if (lockoutTimer) return;

            const input = document.getElementById('admin-pwd-input').value;
            const errorEl = document.getElementById('admin-error');

            if (input === ADMIN_PWD) {
                failedAttempts = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ñ‡∏π‡∏Å
                closeAdminModal();
                openSettings(); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            } else {
                failedAttempts++;
                errorEl.innerText = `‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! (‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${failedAttempts}/3)`;
                errorEl.classList.remove('hidden');

                if (failedAttempts >= 3) {
                    errorEl.innerText = '‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Ñ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ üö®';
                    lockoutTimer = setTimeout(() => {
                        failedAttempts = 0;
                        lockoutTimer = null;
                        if(!document.getElementById('admin-modal').classList.contains('hidden')) {
                            errorEl.classList.add('hidden');
                        }
                    }, 30000); // ‡∏•‡πá‡∏≠‡∏Ñ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                }
            }
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á (UI Navigation) ---
        function openSettings() {
            document.getElementById('main-panel').classList.add('hidden');
            document.getElementById('settings-panel').classList.remove('hidden');
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ Default)
            document.getElementById('input-pid').value = localStorage.getItem('nhso_pid') || DEFAULT_PID;
            document.getElementById('input-cookie').value = localStorage.getItem('nhso_cookie') || DEFAULT_COOKIE;
        }

        function closeSettings() {
            document.getElementById('settings-panel').classList.add('hidden');
            document.getElementById('main-panel').classList.remove('hidden');
            fetchData(); // ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        }

        function saveSettings() {
            const pid = document.getElementById('input-pid').value.trim();
            const cookie = document.getElementById('input-cookie').value.trim();
            
            if(!pid || !cookie) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                return;
            }

            localStorage.setItem('nhso_pid', pid);
            localStorage.setItem('nhso_cookie', cookie);
            
            closeSettings(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏´‡πâ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ---
        async function fetchData() {
            // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Local Storage ‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Default) ‡∏ó‡∏µ‡πà‡∏ù‡∏±‡∏á‡πÑ‡∏ß‡πâ
            const pid = localStorage.getItem('nhso_pid') || DEFAULT_PID;
            const cookie = localStorage.getItem('nhso_cookie') || DEFAULT_COOKIE;

            if (!pid || !cookie) {
                showError('‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PID ‡∏´‡∏£‡∏∑‡∏≠ Cookie');
                document.getElementById('error-sub-msg').innerText = '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚öôÔ∏è ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PID ‡πÅ‡∏•‡∏∞ Cookie ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                return;
            }

            // Reset UI State
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('error-container').classList.add('hidden');
            document.getElementById('debug-info').classList.add('hidden');

            try {
                // ‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡∏´‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå Vercel ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Proxy ‡∏ã‡πà‡∏≠‡∏ô IP ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
                const response = await fetch('/api/quota', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pid: pid, cookie: cookie })
                });

                const rawText = await response.text();
                document.getElementById('loading').classList.add('hidden');

                let data;
                try {
                    data = JSON.parse(rawText);
                } catch (parseError) {
                    if (response.status === 404 || rawText.includes('NOT_FOUND')) {
                        showError('‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                        document.getElementById('error-sub-msg').innerText = '‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå /api/quota.js ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Vercel';
                    } else if (response.status === 500) {
                        showError('‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á (Error 500)');
                        let cleanedText = rawText.replace(/<[^>]*>?/gm, '').substring(0, 150);
                        document.getElementById('error-sub-msg').innerText = "‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: " + (cleanedText || "API ‡∏™‡∏õ‡∏™‡∏ä. ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
                    } else {
                        showError(`‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (HTTP ${response.status})`);
                    }
                    return;
                }

                if (response.ok) {
                    let targetService = findServiceCode(data, 'PG0190010');
                    
                    if (targetService) {
                        document.getElementById('result-container').classList.remove('hidden');
                        
                        let quota = '?';
                        const possibleKeys = ['countresult', 'remain', 'quota', 'balance', 'remain_amount', 'available', 'total', 'qty', 'amount'];

                        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô JSON Object
                        for (let key in targetService) {
                            if (possibleKeys.includes(key.toLowerCase())) {
                                quota = targetService[key];
                                break;
                            }
                        }

                        if (quota === '?' || quota === null || quota === undefined) {
                            document.getElementById('quota-value').innerText = '?';
                            const debugEl = document.getElementById('debug-info');
                            debugEl.classList.remove('hidden');
                            debugEl.innerText = "‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏û‡∏ö ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n" + JSON.stringify(targetService, null, 2);
                        } else {
                            document.getElementById('quota-value').innerText = quota;
                        }

                    } else {
                        showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ PG0190010 ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                        document.getElementById('error-sub-msg').innerText = '‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ';
                    }
                } else {
                    showError(data.error ? `Error: ${data.error}` : `HTTP Error ${response.status}`);
                    document.getElementById('error-sub-msg').innerText = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cookie ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                }
            } catch (err) {
                document.getElementById('loading').classList.add('hidden');
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
                document.getElementById('error-sub-msg').innerText = '‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
            }
            updateTimestamp();
        }

        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ô JSON ‡πÅ‡∏ö‡∏ö‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å
        function findServiceCode(obj, code) {
            if (!obj) return null;
            if (typeof obj === 'object') {
                if (Array.isArray(obj)) {
                    for (let item of obj) {
                        let res = findServiceCode(item, code);
                        if (res) return res;
                    }
                } else {
                    for (let key in obj) {
                        if (obj[key] === code || obj[key] === code.toLowerCase()) return obj;
                        let res = findServiceCode(obj[key], code);
                        if (res) return res;
                    }
                }
            }
            return null;
        }

        function showError(msg) {
            document.getElementById('error-container').classList.remove('hidden');
            document.getElementById('error-msg').innerText = msg;
        }

        function updateTimestamp() {
            document.getElementById('last-update').innerText = new Date().toLocaleTimeString('th-TH');
        }

        // --- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ---
        window.onload = () => {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏∏‡πä‡∏ö ‡∏™‡∏±‡πà‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)
            fetchData();
        };

        // ‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡πÜ 1 ‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
        setInterval(() => {
            if (!document.getElementById('main-panel').classList.contains('hidden')) {
                fetchData();
            }
        }, 60000); 
    </script>
</body>
</html>
